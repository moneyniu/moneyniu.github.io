<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>苹果爱好者的碎碎念 &#8211; 苹果园</title>
<meta name="description" content="Describe this nonsense.">
<meta name="keywords" content="Jekyll, theme, themes, responsive, blog, modern">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="苹果爱好者的碎碎念">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="http://localhost:4000/page3/">
<meta property="og:site_name" content="苹果园">





<link rel="canonical" href="http://localhost:4000/page3/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="苹果园 Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<!--<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">-->
<link href="//fonts.useso.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">


<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<!-- <script src="http://localhost:4000/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>-->
<script src="//cdn.bootcss.com/modernizr/2.6.2/modernizr.min.js"></script>
<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">打开菜单</button>
	<ul class="dl-menu">
		<li><a href="http://localhost:4000/">首页</a></li>
		<li>
			<a href="#">关于</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://localhost:4000/images/avatar.png" alt="yekki photo" class="author-photo">
					<h4>yekki</h4>
					<p>苹果圈儿里中间件最厉害的，中间件圈儿里苹果技术最牛的！</p>
				</li>
				<li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">了解更多</span></a></li>
				<li>
					<a href="mailto:gary.niu@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://weibo.com/yekki"><i class="fa fa-fw fa-twitter"></i> Weibo </a>
				</li>
				
				
				
				<li>
					<a href="https://linkedin.com/in/yekki"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/yekki"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">文章</a>
			<ul class="dl-submenu">
				<li><a href="http://localhost:4000/posts/">所有文章</a></li>
				<li><a href="http://localhost:4000/tags/">所有标签</a></li>
			</ul>
		</li>
		<li>
			<a href="#">主要项目</a>
			<ul class="dl-submenu">
				
	    			
	    			<li><a href="https://github.com/yekki/hackintosh-laptop-workbench" target="_blank">Hackintosh Laptop</a></li>
	    		
	    			
	    			<li><a href="https://github.com/yekki/packer-oracle-linux" target="_blank">Packer for Oracle Linux</a></li>
	    		
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <!--<img src="http://localhost:4000/images/abstract-12.jpg" alt="苹果爱好者的碎碎念">-->
      <img src="http://7xi68d.com1.z0.glb.clouddn.com/abstract-12.jpg" alt="苹果爱好者的碎碎念">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>苹果园</h1>
      <h2>苹果爱好者的碎碎念</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-02-05T00:00:00+08:00"><a href="http://localhost:4000/summary-of-toshiba-portege-z30-b-installation/">February 05, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About yekki">yekki</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
阅读用时 ~1 分钟
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/summary-of-toshiba-portege-z30-b-installation/" rel="bookmark" title="Toshiba Portege Z30-B 安装经验总结" itemprop="url">Toshiba Portege Z30-B 安装经验总结</a></h1>
    
  </header>
  <div class="entry-content">
    <p>公司每两年更新一次电脑，这次，我没有选择Lenovo系列，而是选择了东芝的Z30-B。为啥选择东芝呢？一是Lenovo品质越来越差，我早已对其失望透顶;二是我现在成功黑苹果的都是Lenovo系列，这次想试试东芝系列。经过几天的努力，终于将其成功拿下！虽然整个过程还算顺利，但是也是意外频发，害得我熬了一夜，现在写篇总结，避免后人走弯路。</p>

<p>总得来说，这个机型最难搞得是其显卡HD5500（Broadwell核显）。我使用的方法是AAPL, ig-platform-id注入(参见：<a href="https://www.firewolf.science/2015/04/framebuffer-data-extracted-from-appleintelbdwgraphicsframebuffer-binary/">Framebuffer data extracted from AppleIntelBDWGraphicsFramebuffer binary</a>）。但是，这里需要注意的是：苹果在AppleIntelBDWGraphicsFramebufferbinary里增加了最小被盗内存（minimum stolen memory），如果你的DVMT预置内存小于66MB，这将会导致五国或异常重启。台式机可以在BIOS自由调节DVMT预置内存。笔记本中BIOS默认DVMT内存为32MB，OEM厂商不提供修改的选项。解决这个问题的方法有两个：</p>

<h2 id="clover-kextsdvmt">方法一：通过Clover Kexts注入，修改DVMT断言验证，具体步骤：</h2>

<ul>
  <li>设置SMBIOS</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;key&gt;</span>SMBIOS<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;dict&gt;</span>
	<span class="nt">&lt;key&gt;</span>ProductName-Comment<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;string&gt;</span>Using Haswell MacBookAir6,2 until Clover has support for Broadwell identifiers<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>ProductName<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;string&gt;</span>MacBookAir6,2<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>Trust<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;true/&gt;</span>
<span class="nt">&lt;/dict&gt;</span></code></pre></figure>

<ul>
  <li>ig-platform-id注入</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;key&gt;</span>ig-platform-id<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>0x16260006<span class="nt">&lt;/string&gt;</span></code></pre></figure>

<ul>
  <li>AppleIntelBDWGraphicsFramebuffer.kext 注入</li>
</ul>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dict&gt;</span>
	<span class="nt">&lt;key&gt;</span>Comment<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;string&gt;</span>Disable minStolenSize less or equal fStolenMemorySize assertion, 10.11.beta ( (based on Austere.J patch)<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>Disabled<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;false/&gt;</span>
	<span class="nt">&lt;key&gt;</span>Find<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;data&gt;</span>
	QTnEdj4=
	<span class="nt">&lt;/data&gt;</span>
	<span class="nt">&lt;key&gt;</span>Name<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;string&gt;</span>AppleIntelBDWGraphicsFramebuffer<span class="nt">&lt;/string&gt;</span>
	<span class="nt">&lt;key&gt;</span>Replace<span class="nt">&lt;/key&gt;</span>
	<span class="nt">&lt;data&gt;</span>
	QTnE6z4=
	<span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/dict&gt;</span></code></pre></figure>

<h2 id="biosdvmt">方法二：修改BIOS，增加DVMT值</h2>

<p>我没有试这种方法，实在是太麻烦，更何况修改BIOS是件很危险的事情，搞不好就变砖了。当然，如果有实力，这种方法也是最解决问题的！具体步骤参见：</p>

<p><a href="http://www.tonymacx86.com/yosemite-laptop-support/162062-guide-intel-hd-graphics-5500-os-x-yosemite-10-10-3-a.html">[GUIDE] Intel HD Graphics 5500 on OS X Yosemite 10.10.3</a></p>

<h2 id="section">注意事项</h2>

<p>在整个过程中，我还是犯了以下错误，以后要尽量避免：</p>

<ul>
  <li>config.plist 中忘了添加 SortedOrder 相关条目</li>
  <li>如果包含了所有SSDTs，不要打system_PNOT补丁</li>
  <li>只有在USB3工作不正常时才需要加入GenericUSBXHCI.kext</li>
  <li>打补丁misc_Lid_PRW，避免“睡眠快醒”现象</li>
  <li>外接WIFI会影响电脑睡眠</li>
</ul>

<h2 id="section-1">处理突发问题</h2>

<p>本来安装好后基本完美了，然后想调试下ALPS多点触控功能，于是，把相关Kext放在了/Library/Extensions目录下了，然后就再也进不去了（中间过程中，我用了KCPM Utility Pro 3.3修复权限，此软件用了很长时间，我中途手工中止又重试，所以，我也搞不懂到底是哪个步骤出了问题）。我甚至想用USB启动重装系统，但是还是无法进入系统。后来，我试着在Clover启动界面中手工将ig-platform-id值改为0x16260001，这下倒是进去了，但是显存只有4M了，基本无法使用。我试着重装了一下，然后将系统升级到10.11.3，然后重新修复权限，将ig-platform-id重新改回0x16260006，然后就正常了，显存为1536M。问题虽然解决了，但是有点莫名其妙！</p>

<h2 id="section-2">还不完善的地方</h2>
<p>相对来讲，此型号笔记本不太适合黑苹果，有些问题是无法绕过的，问题如下：</p>

<ul>
  <li>内置Intel 7265NGW（NGFF接口，似乎苹果产品从未使用过此接口，所以找不到合适的卡替换）无解</li>
  <li>ALPS触摸板多指触摸功能还未调试成功</li>
  <li>SD读卡器无解（这个基本不怎么用，所以也没认真研究）</li>
</ul>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-01-20T00:00:00+08:00"><a href="http://localhost:4000/build-clover-behind-http-proxy/">January 20, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About yekki">yekki</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
阅读用时 ~1 分钟
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/build-clover-behind-http-proxy/" rel="bookmark" title="借助CloverGrowerPro编译Clover如何设置代理" itemprop="url">借助CloverGrowerPro编译Clover如何设置代理</a></h1>
    
  </header>
  <div class="entry-content">
    <p>为了得到最新版本的Clover，我使用<a href="https://github.com/yekki/CloverGrowerPro">CloverGrowerPro</a>从源码编译。由于Clover使用SVN管理源代码，而我们公司网络需要设置代理才能访问，因此，我不得不修改CloverGrowerPro以满足要求。具体步骤如下：</p>

<ul>
  <li>修改~/.subversion/servers</li>
</ul>

<figure class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="nn">[global]</span>
<span class="err">http-proxy-</span><span class="py">host</span><span class="p">=</span><span class="s">yourproxyhost</span>
<span class="err">http-proxy-</span><span class="py">port</span><span class="p">=</span><span class="s">yourproxyport</span>
<span class="err">....</span></code></pre></figure>

<ul>
  <li>修改CloverGrowerPro.sh</li>
</ul>

<p>由于使用HTTP代理，我们不得不把所有 “svn://” 改成 “https://”。这里，我们需要改写的是</p>

<p>将</p>

<figure class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="py">CLOVERSVNURL</span><span class="p">=</span><span class="s">'svn://svn.code.sf.net/p/cloverefiboot/code'</span></code></pre></figure>

<p>改为：</p>

<figure class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="py">CLOVERSVNURL</span><span class="p">=</span><span class="s">'https://svn.code.sf.net/p/cloverefiboot/code'</span></code></pre></figure>

<p>另外，在函数installToolchain()，installGettext()，installNasm()中也有对于SVN的调用，我们需要做如下修改</p>

<p>将</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">svn <span class="nb">export</span> --force <span class="s2">"</span><span class="nv">$CLOVERSVNURL</span><span class="s2">"</span>/buildnasm.sh <span class="s2">"</span><span class="nv">$srcDIR</span><span class="s2">"</span>/buildnasm.sh &gt;/dev/null</code></pre></figure>

<p>改为：</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">svn <span class="nb">export</span> --config-option servers:global:http-proxy-host<span class="o">=</span>yourproxyhost --config-option servers:global:http-proxy-port<span class="o">=</span>yourproxyport --force <span class="s2">"</span><span class="nv">$CLOVERSVNURL</span><span class="s2">"</span>/buildnasm.sh <span class="s2">"</span><span class="nv">$srcDIR</span><span class="s2">"</span>/buildnasm.sh &gt;/dev/null</code></pre></figure>

<p>当然，为了方便使用，你也可以定义个变量存放代理设置，例如：</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">PROXY</span><span class="o">=</span><span class="s2">"--config-option servers:global:http-proxy-host=yourproxyhost --config-option servers:global:http-proxy-port=yourproxyport"</span>

......

svn <span class="nb">export</span> <span class="nv">$PROXY</span> --force <span class="s2">"</span><span class="nv">$CLOVERSVNURL</span><span class="s2">"</span>/buildnasm.sh <span class="s2">"</span><span class="nv">$srcDIR</span><span class="s2">"</span>/buildnasm.sh &gt;/dev/null</code></pre></figure>

<p>另外，在运行 “./CloverGrowerPro.sh -s” 时，记得将svn改成https，例如：</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">EDK2 svn url to use <span class="o">[</span>svn://svn.code.sf.net/p/edk2/code/trunk/edk2]:https://svn.code.sf.net/p/edk2/code/trunk/edk2</code></pre></figure>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-01-19T00:00:00+08:00"><a href="http://localhost:4000/how-to-view-and-clear-the-mac-nvram-contents/">January 19, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About yekki">yekki</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
阅读用时 ~1 分钟
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/how-to-view-and-clear-the-mac-nvram-contents/" rel="bookmark" title="如何查看与清除NVRAM内容" itemprop="url">如何查看与清除NVRAM内容</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="nvram">查看NVRAM内容</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nvram -xp</code></pre></figure>

<p>参数-p 是查看，-x 是以XML格式查看</p>

<h2 id="nvram-1">删除NVRAM变量</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nvram -d <span class="o">(</span>variable key name goes here<span class="o">)</span></code></pre></figure>

<p>例如：</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nvram -d SystemAudioVolume</code></pre></figure>

<h2 id="nvram-2">清除所有NVRAM变量</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">nvram -c</code></pre></figure>

<p>重置NVRAM变量还有一个比较麻烦的办法是：重启电脑，并同时按下： Command+Option+P+R，听到两声电脑重启的声音后松开按键。</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-01-17T00:00:00+08:00"><a href="http://localhost:4000/laptop-hardware-knowledge/">January 17, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About yekki">yekki</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
阅读用时 ~1 分钟
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/laptop-hardware-knowledge/" rel="bookmark" title="笔记本硬件基础知识" itemprop="url">笔记本硬件基础知识</a></h1>
    
  </header>
  <div class="entry-content">
    <p>BIOS（Basic Input/Output System，基本输入输出系统）在整个系统中的地位是非常重要的，它实现了底层硬件和上层操作系统的桥梁。比如你现在从光盘拷贝一个文件到硬盘，您只需知道“复制、粘贴”的指令就行了，您不必知道它具体是如何从光盘读取，然后如何写入硬盘。对于操作系统来说也只需要向BIOS发出指令即可，而不必知道光盘是如何读，硬盘是如何写的。BIOS构建了操作系统和底层硬件的桥梁。</p>

<p>EC（Embed Controller，嵌入式控制器）是一个16位单片机，它内部本身也有一定容量的Flash来存储EC的代码。EC在系统中的地位绝不次于南北桥，在系统开启的过程中，EC控制着绝大多数重要信号的时序。在笔记本中，EC是一直开着的，无论你是在开机或者是关机状态，除非你把电池和Adapter完全卸除。</p>

<p>在关机状态下，EC一直保持运行，并在等待用户的开机信息。而在开机后，EC更作为键盘控制器，充电指示灯以及风扇等设备的控制，它甚至控制着系统的待机、休眠等状态。</p>

<p>现在的EC有两种架构，即BIOS的FLASH通过X-BUS接到EC，然后EC通过LPC接到南桥，一般这种情况下EC的代码也是放在FLASH中的，也就是和BIOS共用一个FLASH。比较新的架构，EC和FLASH共同接到LPC总线上，一般它只使用EC内部的ROM。至于LPC总线，它是INTEL当初为了取代低速落后的X-BUS而推出的总线标准。</p>

<p>EC上一般都含有键盘控制器，所以也称KBC(Keyboard Controller)。</p>

<p>在系统关机的时候，只有RTC部分和EC部分在运行。RTC部分维持着计算机的时钟和CMOS设置信息，而EC则在等待用户按开机键。在检测到用户按开机键后，EC会通知整个系统把电源打开（这部分在最后详细介绍）。CPU被RESET后，会去读BIOS内一个特定地址内的指令（其实是一个跳转指令，这个地址是由CPU硬件设定的）。</p>

<p>这里开始分两种情况，对于第一种的结构：CPU发出的这个地址通过FSB到北桥，然后通过HUB-LINK到南桥，通过LPC到EC，再通过X-BUS一直到达BIOS。在CPU读到所发出的地址内的指令后，执行它被RESET后的第一个指令。在这个系统中，EC起到了桥接BIOS和南桥（或者说整个系统）的作用。
对于第二种结构：在这地址南桥后，会直接通过LPC到BIOS，不需要EC的桥接。</p>

<p>这里需要说明的是，对于台式机而言，一般是不需要EC的。这里原因有很多：比如台式机本身的ATX电源就具有一定的智能功能，他已经能受操作系统控制来实现待机、休眠的状态；其次由于笔记本的键盘不能直接接到PS/2接口，而必须接到EC之上；还有就是笔记本有更多的小功能，比如充电指示灯、WIFI指示灯、Fn等很多特殊的功能，而且笔记本必须支持电池的冲放电等功能，而智能冲放电则需要EC的支持；另外，笔记本TFT屏幕的开关时序也必须由EC控制。这些原因导致了笔记本使用EC来做内部管理的必要性。</p>

<p>总体来说，EC和BIOS都处于机器的最底层。EC是一个单独的处理器，在开机前和开机过程中对整个系统起着全局的管理。而BIOS是在等EC把内部的物理环境初始化后才开始运行的。</p>

<p>在南桥上还有一个功能块就是电源管理单元（PM，Power Management）。</p>

<p>一般来说，他和EC来共同配合完成。这里包括从开机（power button）键按下后，启动，待机，休眠，关机的全部功能。还包括对背光亮度，声音等的控制等等。</p>

<p>至于现在Intel的Speed Step技术，也有部分功能是透过南桥来实现的（南桥发送SLP、STPCLK（sleep，Stop Clock）来实现睡眠、深睡眠等）。</p>

<p>在台式机上，我们常听到关于集成网卡这个说法。而对于笔记本来说，网卡一般都是集成在主板上的，进入PIII时代以后，就显有无内建网卡的机器了。对于笔记本网卡来说（不考虑PCMCIA的网卡哦），一般有两种接法。</p>

<p>首先我们把网卡分成两个部分。现在的LAN都属于802.3的协议。而这个协议的物理实现却并非那么简单，需要分成两个部分。一部分是MAC控制层（Media Access Controller 媒体接入控制器），作用是根据802.3协议来做运算（采用CSMA/CD算法），另一部分是物理连接层（PHY）作用是根据MAC的算法得出的处理结果，接收和发送数据。</p>

<p>首先我们谈第一种，走PCI总线的网卡。如果这样接的话跟台式机的网卡唯一的区别就是把台式机的PCI网卡直接做到主板上。这颗走PCI的网卡芯片内部整合了MAC和PHY功能。实际使用中，高档一些的笔记本会采用INTEL的网卡，低档一些的就会用REALTLK或者VIA的芯片。当然，INTEL网卡的传输效率确实也比较高。</p>

<p>第二种则是“真正集成”的网卡，MAC层部分被做到了南桥里面，然后需要用一个外围电路（PHY）来配合南桥里的MAC来实现网卡的功能。
 南桥内部的网卡MAC输出一组信号线（称为MII总线），连接PHY（上图中的Intel 82562ET），然后引出RX+-和TX+-两对差分线，透过Transformer来控制EMI，然后输出到RJ45接口即刻。这里的Transformer的结构跟USB的共模电感相似，作用也相似。上面的REALTLK8100C的那张图中，红色框内就是Transformer。经过Transformer的信号线必须以最短的距离接到RJ45接口上以减少干扰，所以它离和RJ45的距离是必须被严格控制的。</p>

<p>那么MAC地址是什么呢？MAC地址是区别网络设备的唯一物理标志，理论上，世界上任何一个网络设备的MAC应该都是不同的。
对于走PCI总线的网卡，一般会在网卡上挂一个小小的的E2PROM来存储，里面烧有MAC地址以及一些厂商信息。而对于用PHY来连接的网卡，会把MAC地址信息放在挂在南桥上的E2PROM（因为网卡的MAC控制器在南桥）。而1394和网卡的构建形式差不多，也是由MAC控制器和PHY来构成。其原理和布线准则也和网卡类似。</p>

<p>PCI设备：PCMCIA, Mini PCI</p>

<p>1989年由200多家公司确立了PCMCIA(Personal Computer Memory Card International Association)标准，最初只是用来扩展内存，91年后随着I/O设备扩展需求，多种设备都被做成了PCMCIA接口，PCMCIA成为了笔记本最重要的扩展插槽。PCMCIA的成长史几乎是整个笔记本电脑产业的成长史。那PCMCIA到底是如何实现的呢？</p>

<p>实际上，PCMCIA的实现方法并不复杂，把南桥的PCI总线拉到PCMCIA控制器，然后从PCMCIA控制器就能输出Cardbus，接上标准的PCMCIA接口就可以了。</p>

<p>实际上在设计的时候，CardBus Controller的设计厂商都已经对其开发作好了一整套的外围电路，OEM厂商只需要简单的按标准电路做简单的修改即可（比如一些降低成本的动作）。一般来说，CardBus Controller有TI，RICHO，ENE等几家可以选择。</p>

<p>至于mini PCI则更加简单了，只需把南桥的PCI总线点到点的接到miniPCI的接口上即可。顺便说一句，mini PCI和台式机上的PCI的物理定义是一致的，不同的仅仅是插槽不一致而已。</p>

<p>待续……</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-01-12T00:00:00+08:00"><a href="http://localhost:4000/clover-power-management/">January 12, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="http://localhost:4000/about/" title="About yekki">yekki</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
阅读用时 ~1 分钟
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://localhost:4000/clover-power-management/" rel="bookmark" title="Clover电源管理相关项解释" itemprop="url">Clover电源管理相关项解释</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="cloverivysandyhaswell">Clover中Ivy/Sandy/Haswell机型电源管理检查列表</h2>

<ul>
  <li>SSDT.aml at EFI/Clover/ACPI/patched</li>
  <li>config.plist/KernelAndKextPatches/AsusAICPUPM=true (Haswell以前型号)</li>
  <li>config.plist/KernelAndKextPatches/KernelPm=true (Haswell及以后型号)</li>
  <li>config.plist/KernelAndKextPatches/KernelLapic=true (用于有Local APIC panic问题的机器)</li>
  <li>根据你的CPU找到合适的系统定义，即：SMBIOS (config.plist/SMBIOS)</li>
  <li>没有使用老版本AppleACPIPlatform.kext</li>
  <li>没有使用NullCPUPowerManagement.kext</li>
  <li>处理器对象在DSDT中的Scope (_SB) or Scope (_PR)中定义in DSDT (一般很少在OEM DSDT找不到定义)</li>
  <li>校验生成的SSDT注入到DSDT相同的Scope（通常为_PR）</li>
</ul>

<h2 id="drop-oem">关于Drop OEM</h2>
<ul>
  <li>SSDT可以借助Clover的Generate PStates与Generate CStates等选项生成，但是DSDT不可以生成，尽管BIOS提供一个</li>
  <li>被放置在/EFI/CLOVER/ACPI/patched目录下的SSDTs将被添加到OEM/BIOS提供的SSDTs</li>
  <li>被放置在/EFI/CLOVER/ACPI/patched目录下的DSDT将替换OEM/BIOS提供的DSDT</li>
</ul>

<h3 id="ssdts">由于SSDTs是追加模式，因此，可能存在冲突。解决方法有两个：</h3>

<ul>
  <li>完全忽略OEM/BIOS提供的SSDTs，即：M打开Clover的Acpi/SSDT/Drop OEM</li>
  <li>删除部分OEM/BIOS提供的SSDT表，即：打开Clover的Acpi/Drop Tables中的项目，例如：删除DMAR，避免在BIOS中关闭VT-D功能</li>
</ul>

<h3 id="drop-oem-1">何时需要使用Drop OEM？</h3>
<p>对于一些老机型，例如：Sandy Bridge或更老的机型，通常需要使用Drop OEM，并且使用Generate PStates与Generate CStates来生成可变频SSDT。
但是对于现在的主流机型，如：Broadwell/Haswell/Ivy，通常无需Drop OEM就可以正常工作。</p>

<h2 id="section">电源管理测试</h2>

<p>10.11以后，很多过去可以用的软件不再能用，例如：DCPIManager.app。现在通常使用AppleIntelInfo.kext来测试电源管理是否生效。</p>

<p>下载并编译（至少是Xcode 7.0 Beta）<a href="https://github.com/Piker-Alpha/AppleIntelInfo">AppleIntelInfo.kext</a></p>

<p>设置权限与所有者AppleIntelInfo.kext</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sudo chown -R root:wheel AppleIntelInfo.kext
sudo chmod -R 744 AppleIntelInfo.kext</code></pre></figure>

<p>加载AppleIntelInfo.kext</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sudo kextload/kextutil AppleIntelInfo.kext</code></pre></figure>

<p>卸载AppleIntelInfo.kext</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sudo kextunload AppleIntelInfo.kext</code></pre></figure>

<p>查看测试结果</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sudo cat /tmp/AppleIntelInfo.dat</code></pre></figure>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="http://localhost:4000/page2/" class="btn">上一页</a></li>
      
    

    
    
      <li><a href="http://localhost:4000">1</a></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="http://localhost:4000/page2/">2</a></li>
      
    
      
        <li><strong class="current-page">3</strong></li>
      
    
      
        
        
        
        <li><a href="http://localhost:4000/page4/">4</a></li>
      
    
      
        
        
        
        <li><a href="http://localhost:4000/page5/">5</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="http://localhost:4000/page10/">10</a></li>
    

    
    
      <li><a href="http://localhost:4000/page4/" class="btn">下一页</a></li>
    
  </ul>
</div>

</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 yekki. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
<script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>



          

</body>
</html>